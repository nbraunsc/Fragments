import pyscf
from pyscf import gto, scf, ci, cc, mp, hessian, lib, grad, mcscf
from pyscf.geomopt.berny_solver import optimize

mol = gto.Mole()
mol.atom = '''
C          1.52500        3.09700        1.54700
C          0.62800        3.98000        0.66900
C          1.49800        4.87200       -0.23500
C          2.41600        5.77800        0.62300
C          3.32200        4.84600        1.47900
C          2.44600        3.97400        2.42900
C          3.34500        3.07900        3.29200
C          4.23300        3.96700        4.17300
C          3.33000        4.85700        5.08700
N          2.35300        5.64500        4.31900
C          1.57500        6.60300        5.12000
C          0.66300        7.51900        4.24000
C         -0.23700        6.64200        3.36000
C          0.64600        5.76500        2.46300
C         -0.24300        4.85500        1.58000
H         -0.87900        4.21900        2.20900
H         -0.92000        5.46400        0.96800
C          1.49500        6.66300        1.51300
C          2.23500        7.75800        2.23500
C          1.51300        8.47200        3.34600
C          2.45100        9.34200        4.23300
C          1.55000       10.19700        5.16000
C          0.67900        9.28900        6.04900
C         -0.20800        8.39800        5.16900
H         -0.88600        9.02500        4.57600
H         -0.84400        7.76700        5.80400
C          1.57600        8.39100        6.91100
C          2.48100        7.51200        6.01400
C          3.38000        6.62900        6.88900
C          4.25100        5.75100        5.98100
C          5.15200        4.83500        6.84400
C          6.03800        3.95900        5.94800
C          5.13500        3.08300        5.06900
H          5.75400        2.42100        4.45100
H          4.51900        2.43200        5.70300
C          6.92400        4.85100        5.05900
C          6.04700        5.76500        4.16600
C          5.16500        4.83900        3.27800
H          5.84200        4.15500        2.74000
C          4.42600        5.57800        2.19400
C          5.14500        6.67700        1.46200
C          4.19800        7.57000        0.60500
C          3.31700        8.49600        1.49600
C          4.21500        9.36600        2.42500
C          5.16300        8.48900        3.29700
C          4.44800        7.74900        4.39400
C          3.35700        8.46500        5.14600
H          3.88900        9.14300        5.83300
C          5.18300        6.64900        5.11100
H          5.87100        7.17100        5.79600
C          6.02800        7.56300        2.39100
C          6.88900        8.47600        1.48200
C          5.98600        9.36700        0.61000
C          5.08900        8.48200       -0.27400
H          4.46600        9.11500       -0.91900
H          5.71300        7.87500       -0.94300
C          5.10600       10.24900        1.51500
H          4.48400       10.90800        0.89700
H          5.74200       10.90300        2.12500
H          6.60900       10.00600       -0.02600
H          7.53900        7.86900        0.83900
H          7.55100        9.10400        2.09100
C          6.92400        6.66400        3.27000
H          7.57500        6.04700        2.63700
H          7.58700        7.28200        3.88900
H          5.85100        9.17100        3.82300
C          3.32900       10.24100        3.33700
H          2.69600       10.90000        2.72900
H          3.95500       10.89500        3.95700
H          2.77700        9.18200        0.82400
C          3.29400        6.67800       -0.27200
H          2.66100        7.30100       -0.91800
H          3.90800        6.06000       -0.94100
H          5.82100        6.15400        0.76700
H          7.58700        5.45800        5.68900
H          7.57500        4.22200        4.43800
H          6.67300        3.32000        6.57200
H          4.53600        4.19900        7.49300
H          5.78300        5.43900        7.50900
H          2.76700        6.00100        7.55000
H          4.00800        7.24800        7.54200
H          0.95500        7.76000        7.56000
H          2.18900        9.01400        7.57600
H          0.04900        9.90900        6.69700
H          0.90600       10.85600        4.56300
H          2.16500       10.85100        5.79100
H          0.81600        9.15500        2.83400
H          0.79700        7.19000        0.84400
C          1.55800        4.86400        3.35800
H          0.90600        4.19700        3.94300
H         -0.88500        6.01400        3.98600
H         -0.90300        7.26700        2.75000
H          0.92300        6.01600        5.78600
H          2.75900        4.19000        5.75100
H          3.96100        2.42800        2.65800
H          2.73200        2.41600        3.91800
H          3.84000        4.16300        0.78700
H          0.85400        5.48300       -0.88000
H          2.10100        4.24300       -0.90300
H         -0.01400        3.34600        0.04700
H          2.12500        2.43400        0.91000
H          0.90400        2.44600        2.17600
'''
mol.basis = '6-31g*'
mol.charge = -1
mol.spin = 2 #nelec_alpha - nelec_beta
mol.build(symmetry=True)
mf = scf.RHF(mol)
mol_eq = optimize(mf)
mf.kernel()


## 6 orbitals, 8 electrons
#state_id : 0 is ground state, state_id=1 would be first excited state
state_id = 0
mc = mcscf.CASSCF(mol_eq, 6, 8).state_specific_(state_id)
mc.verbose = 5
hartree = mc.kernel()[0]
energy = hartree*27.2114

state_id = 1
mce = mcscf.CASSCF(mol_eq, 6, 8).state_specific_(state_id)
mce.verbose = 5
hartree_ex = mce.kernel()[0]
energye = hartree_ex*27.2114

print("Energy =", hartree, "Hartree")
print("Energy ground state =", energy, "eV")
print("Energy =", hartree_ex, "Hartree")
print("Energy excited state =", energye, "eV")
print("excitation energy = ", energye-energy, "eV")

#mc = mcscf.CASSCF(mf, 6, 8)
#mc.state_specific_(1)
#excited_grad = mc.nuc_grad_method().as_scanner()
#mol1 = excited_grad.optimizer().kernel()[0]*27.2114
#print('Energy of optmized strucutre = :', mol1, "eV")


